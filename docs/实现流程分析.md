## 命令行界面上传流程

加载配置 -> 异步异常处理 -> 处理文件 -> 处理命令行参数  
-> 初始化浏览器上下文 -> 根据每个网站Cookie或者localStorage判断是否登录 ->  
| -> 未登录则进行登录流程  
| -> 首次登录会关闭页面   ->  
| -> 已登录直接上传文章  
-> 上传成功后返回结果  

### 加载配置

读取配置文件，存储在全局变量中

### 异步异常处理

如果开启调试模式，执行结束会将所有异步信息记录在异常组中并抛出
若非调试模式，则只会提示大概异常信息

### 处理文件

上传的文件会被分别解析为docx,html,md文件，并在上传文件所在的目录下保存
docx文件中的图片会被提取并保存在md文件所在目录的img文件夹中，并根据顺序以 `img0.png` `img1.png` 等的格式命名  
html与md文件中的图片路径会被自动替换为绝对路径

### 初始化命令参数

将命令行参数解析为字典，并将其保存到社区类的实例中，供后续使用

### 初始化浏览器上下文

根据配置文件中的配置，初始化浏览器以及浏览器上下文

### 登录判断流程
通过逐个分析得知，这些社区类网站的登录大部分都是会存储Cookie或者localStorage  
如果加载站点后Cookie的某个name值变化或者消失，说明登录过期，此时需要重新登录  
对每一个社区网站页面会首先判断本页面Cookie是否对应  
接着判断本地存储的storage.json文件中是否存在，如果存在则说明已经登录  
为满足则重新跳转至登录界面  
> 代码中表现为所有社区类的父类提供了统一的登录判断方法  
> 如果有不同的判断方式可以重写，不影响执行流程

### 登录流程

当检测到登录过期或者未登录时，会进入登录流程  
此时需要用户手动登录，因为验证码的形式过多，目前精力有限无法实现自动化    
登陆成功后，页面会判断出响应的数据是否包含登录成功的信息  
> 代码中表现为在等待登录成功时会设置无限的超时时间，直到登录成功  

### 上传流程

根据命令行以及配置中的信息，选择对应的社区类，并调用其上传方法  
> 上传是异步的，互相不影响，可以并行执行  


## UI界面上传流程

### 创建WebView的窗口UI界面以及Flask守护线程前后端

#### 创建窗口

读取配置文件中的窗口宽高，创建WebView的窗口UI界面，并设置WebView的属性
#### 创建Flask守护线程
启动Flask守护线程，随窗口关闭自动关闭  
通过托管前端静态文件夹实现动态前端框架的加载  
绑定所有Flask的BluePrint，实现API路由功能  
启动指定端口，并且该端口被前端后端共同享用，防止出现跨域问题
#### 启动窗口界面
通过读取配置文件中的debug和storage_path，判断是否开启调试模式，以及窗口界面存储路径  

### 前后端联调事件

前后端分离的架构使得PostSync既可以利用Python中的各种库，又可以使界面美观

虽然有人诟病Chrome内核导致内存牺牲较多  
但是本软件并不致力于后台运行，在当今的硬件条件下，牺牲内存但节省时间是值得的  

#### 总体布局

总体布局根据vh,vw单位，设置了顶部导航栏，左侧侧边栏，右侧主体区域  
会随着窗口的改变调整字体大小，左右内容区域的宽度  

#### 仪表盘界面

判断用户是否登录，并将其存入localStorage中

返回结果后会操作localStorage中的登录状态，并刷新页面  
并且不是每次进入软件都会重新判断是否登录，而是读取localStorage中的登录状态  
后端会判断Cookie或者localStorage是否符合登录成功后的条件得到是否已经登录的结果  

如果未登录，则显示未登录通知以及登录按钮，点击后启动新的浏览器实例登录，并在后端能自动判断是否登录成功  

显示文章列表，提供快捷上传与删除操作  
内置vue-router实现页面的切换并提供数据交换  

#### 新文章界面

搭配md-editor-v3富文本编辑器，提供保存与快速导航到上传的功能  
保存文章会在本地存入`config['data']['posts']['path']`工作区文件
支持实时预览

#### 上传文章界面

由于浏览器禁止访问本地文件，因此上传文件需要借助后端API，通过pywebview提供的dialog，选择路径与封面  
后端收到数据后会新建浏览器实例，  并直接传入参数进行类似命令行界面的上传流程  
上传成功失败错误都会返回前端  

#### 设置界面

通过后端返回的config.yaml解析后的Json数据，通过递归的算法生成设置界面控件  
如果是列表（数组）字段会生成标签输入框
